<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <title>Life!</title>
    <link rel="icon" href="https://d3v3cbxkdlyonc.cloudfront.net/stocks/favicon.ico">
    <link rel="apple-touch-icon" href="https://d3v3cbxkdlyonc.cloudfront.net/stocks/apple-touch-icon.png">
    <meta name="description" content="A lightweight, blazing-fast page to distill the meaningful things in my life">

    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
          "Oxygen", "Ubuntu", "Helvetica Neue", Arial, sans-serif;
      }
      table { font-family: Courier, monospace; }
      blockquote {
          font-size:1em;
          margin:0.5em 20px;
          font-style:italic;
          color: #555555;
          padding:0.1em 10px;
          border-left:8px solid #78C0A8 ;
          line-height:1.6;
          position: relative;
          background:#EDEDED;
      }
      .stocks-container {
        margin-bottom: 1.5em;
        width: 100%;
        max-width: 600px;
      }
      .stocks-container a { text-decoration: none; }
      table {
        border-collapse: collapse;
        width: 100%;
        font-size: 1.05em;
      }
      .stock-symbol {
        width: 12%;
        padding: 2px 4px 2px 0px;
      }
      .stock-price, .stock-change, .stock-change-pct, .stock-mkt-cap {
        width: 22%;
        text-align: right;
        padding: 2px 4px;
      }
      @media (max-width: 576px) {
        table { margin-bottom: 3em; }
        .stock-mkt-cap { display: none; }
        .stock-symbol { width: 16%; }
        .stock-price, .stock-change, .stock-change-pct { width: 28%; }
        td.stock-symbol, td.stock-price, td.stock-change, td.stock-change-pct {
          padding-top: 1em;
          padding-bottom: 1em;
        }
      }
      summary:hover { cursor: pointer; }
      summary::-webkit-details-marker { display: none; }

      /* Style the tab */
      .tab {
        overflow: hidden;
        border: 1px solid #ccc;
        background-color: #f1f1f1;
      }
      /* Style the buttons that are used to open the tab content */
      .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
      }
      /* Change background color of buttons on hover */
      .tab button:hover {
        background-color: #ddd;
      }
      /* Create an active/current tablink class */
      .tab button.active {
        background-color: #ccc;
      }
      /* Style the tab content */
      .tabcontent {
        display: none;
        padding: 6px 12px;
        border: 1px solid #ccc;
        border-top: none;
      }

      .row {
        display: flex;
      }
      .left {
        flex: 30%;
        padding: 10px;
      }
      .right {
        flex: 70%;
        padding: 10px;
      }

    </style>
  </head>

  <body>

    <!-- Tab links -->
    <div class="tab">
      <button class="tablinks" onclick="openTab(event, 'Today')" id="defaultOpen">Today</button>
      <button class="tablinks" onclick="openTab(event, 'Financial')">Financial</button>
      <button class="tablinks" onclick="openTab(event, 'LessMore')">Less & More</button>
      <button class="tablinks" onclick="openTab(event, 'SimpleJoys')">Simple Joys</button>
    </div>

    <!-- Tab content -->
    <div id="Today" class="tabcontent">
      <div class="row">
        <div class="left">
          <h3>💭 Quotes</h3>
          <blockquote>
          <p>It isn't personal. It isn't permanent. It isn't important. <br>It is important to be kind to all, to maintain my center, to be respectful, magnanimous, and wise.</p>
          </blockquote>
          <blockquote>
          <p>"To invent your own life's meaning is not easy, but it's still allowed, and I think you'll be happier for the trouble." <br>[<a href="https://www.graduationwisdom.com/speeches/0025-watterson.htm">Bill Watterson</a>]</p>
          </blockquote>
          <blockquote>
          <p>"This bus makes many stops. I have no expectation that you will like all of them." <br>[<a href="https://www.reddit.com/r/IAmA/comments/197ji0/i_am_anthony_bourdain_ask_me_anything/c8lhrth/">Anthony Bourdain</a>]</p>
          </blockquote>
          <blockquote>
          <p>"Nonsense? That's how we roll." <br>[<a href="https://streamable.com/6q8n">Kill la Kill</a>]</p>
          </blockquote>
          <blockquote>
          <p>"The whole problem with the world is that fools and fanatics are always so certain of themselves, and wiser people so full of doubts." <br>[Bertrand Russell]</p>
          </blockquote>
        </div>
        <div class="right">
          <h3>🔨 Projects</h3>
          <ul>
          <li>Mount microwave facade.</li>
          <li>Bluetooth speaker wiring.</li>
          <li>Front door quote.</li>
          <li>Clear brush on hill.</li>
          <li>Bird bath.</li>
          </ul>
          <h3>💪 Challenges</h3>
          <ul>
          <li>"I'm happy to see you!"</li>
          <li>Daily exercise sets</li>
          <li>Swimming and hiking twice each month</li>
          </ul>
          <h3>🔬 Focus</h3>
            <ul style="list-style-type:none">
            <p><b>S</b>uccessful, talented people are often frustrated for a simple reason: The world is constantly disappointing them. They expect everyone to be like them, to work as hard as them, to care as much as them, to hold themselves to the same standards as they do. And if not that, at the very least, we expect people to show up and do their jobs.</p>
            <p>It’s the difference between these expectations and reality that makes us angry. It’s understandable, but that doesn’t make it okay. Because not only is this a miserable way to live, but worse, it makes other people miserable, too. And, that’s what is particularly inexcusable. You’re not allowed to externalize your crap onto other people. You can’t make the world worse because of your own inflexibility.</p>
            <p>It’s not manly to get angry, Marcus Aurelius wrote. It’s not natural either. It’s better to be calm and controlled, he said. It’s better to treat people with kindness. Don’t go expecting Plato’s Republic, he said. If there are brambles in the path, he said, go around. Why get angry? As if the world will care or notice.</p>
            <p>It’s wonderful that you have high standards. It’s wonderful that you are demanding of yourself. It’s wonderful that you do your job. But you have to be willing to be flexible and tolerant with other people. You have to be patient. You have to keep your frustrations in check. That’s what Stoicism is about. That’s what the point of all this is.</p>
            <p>Don’t let yourself get away with anything less.<p>
            </ul>
        </div>
      </div>
      <hr>
      <p style="font-size:0.8em">Inspired by <a href="https://www.jacobyyoung.com/" target="_blank">this page</a></p>
    </div>

    <div id="Financial" class="tabcontent">
        <h2><div id="fire"></div></h2>
        <hr>

        <div class="stocks-container"></div>

        <hr>
        <p class="news" style="font-size:1.0em">
          <h3>📰 News</h3>
          <a href="https://www.google.com/search?tbm=fin&q=NASDAQ:+AMZN&stick=H4sIAAAAAAAAAONgecRoyi3w8sc9YSmdSWtOXmNU4-IKzsgvd80rySypFJLgYoOy-KR4uLj0c_UNzKtyLA2yeRax8vg5Brs4BlopOPpG-QEA3pWyeEkAAAA&wptab=NEWS" target="_blank">AMZN</a><br>
          <a href="https://www.google.com/search?tbm=fin&wptab=NEWS&q=INDEXDJX:+.DJI" target="_blank">DJIA</a><br>
          <a href="https://www.google.com/search?tbm=fin&wptab=NEWS&q=INDEXNASDAQ:+.IXIC" target="_blank">NASDAQ</a><br>
        </p>
        <hr>

        <p class="updated-timestamp" style="font-size:0.8em"></p>
        <p style="font-size:0.8em">Customize <a href="https://github.com/toddwschneider/stocks" target="_blank">on GitHub</a></p>
        <!--
        <p class="attribution" style="font-size:0.8em">
          Data provided for free by <a href="https://iextrading.com/developer/" target="_blank">IEX</a>.
          Subject to <a href="https://iextrading.com/api-exhibit-a/" target="_blank">IEX Exhibit A</a>.
        </p>
        -->
    </div>

    <div id="LessMore" class="tabcontent">
      <h3>⛔ Less</h3>
      <ul>
      <li>Snacking after 9:00p</li>
      <li>Eat less than half of restaurant portion</li>
      <li>Personal Spending</li>
      <li>Poor sleep habits</li>
      <li>Binge drinking</li>
      </ul>
      <h3>✅ More</h3>
      <ul>
      <li>Hikes</li>
      <li>Swimming</li>
      <li>Exercise</li>
      <li>Working outside</li>
      <li>Homebrewing</li>
      <li>DIY gifts</li>
      </ul>
    </div>

    <div id="SimpleJoys" class="tabcontent">
      <h3></h3>
      <ul>
      <li>Rough snuggles in bed after Mama leaves for work</li>
      <li>Snow falling at night</li>
      <li>Family teamwork on travel adventures</li>
      <li>Watching David play with his friends</li>
      <li></li>
      </ul>
    </div>

    <script>
      'use strict';

      const DEFAULT_PORTFOLIOS = [
        {'name': '📈 Market ETFs', 'symbols': ['DIA', 'SPY', 'QQQ']},
        {'name': '📈 Stocks', 'symbols': ['AMZN', 'AAPL', 'BABA', 'COST', 'MSFT', 'SBUX']}
      ];

      // register for a token at https://iexcloud.io/
      const API_TOKEN = 'sk_63bc9f2bd6f34900bfa57f9360b1741f';
      if (API_TOKEN === 'YOUR_TOKEN_HERE') {
        alert('You need to register for a token at https://iexcloud.io/');
      }

      const PORTFOLIOS = portfoliosFromQueryParams() || DEFAULT_PORTFOLIOS;
      const REFRESH_SECONDS = 60;
      const BATCH_SIZE = 100;
      const BASE_URL = 'https://cloud.iexapis.com/stable/stock/market/batch';
      const FAVICON_SYMBOL = 'SPY';
      const FAVICON_BASE_URL = 'https://d3v3cbxkdlyonc.cloudfront.net/stocks';

      let symbols = [FAVICON_SYMBOL];
      let containerDiv = document.querySelector('.stocks-container');
      let updatedDiv = document.querySelector('.updated-timestamp');

      PORTFOLIOS.forEach((p, i) => addPortfolio(p, i === 0));
      symbols = symbols.filter((s, i) => symbols.indexOf(s) === i);
      updateData('addTitle');
      setInterval(updateData, REFRESH_SECONDS * 1000);

      function addPortfolio(portfolio, includeHeader) {
        let tableHeaderHtml = '';
        if (includeHeader) {
          tableHeaderHtml = `
            <thead>
              <tr>
                <th></th>
                <th class="stock-price">Last</th>
                <th class="stock-change">Change</th>
                <th class="stock-change-pct">Change%</th>
                <th class="stock-mkt-cap">Mkt Cap</th>
              </tr>
            </thead>
          `
        }
        let tableBodyHtml = portfolio.symbols.map(symbol => {
          symbol = symbol.toUpperCase();
          symbols.push(symbol);
          let html = `
            <tr data-symbol="${symbol}">
              <td class="stock-symbol"><a href="${symbolUrl(symbol)}" target="_blank">${symbol}</a></td>
              <td class="stock-price"></td>
              <td class="stock-change"></td>
              <td class="stock-change-pct"></td>
              <td class="stock-mkt-cap"></td>
            </tr>
          `
          return html;
        }).join('');
        let portfolioDiv = document.createElement('div');
        portfolioDiv.innerHTML = `
          <details open>
            <summary><h3>${portfolio.name}</h3></summary>
            <table>${tableHeaderHtml}<tbody>${tableBodyHtml}</tbody></table>
          </details>
        `;
        containerDiv.appendChild(portfolioDiv);
      }
      function updateData(addTitle) {
        let numberOfBatches = Math.ceil(symbols.length / BATCH_SIZE);
        for (let i = 0; i < numberOfBatches; i++) {
          let symbolsBatch = symbols.slice(i * BATCH_SIZE, (i + 1) * BATCH_SIZE);
          updateDataForBatch(symbolsBatch, addTitle);
        }
        updatedDiv.innerHTML = `Data updated at ${(new Date()).toLocaleString()}`;
      }
      function updateDataForBatch(symbols, addTitle) {
        let filters = ['latestPrice', 'change', 'changePercent', 'marketCap'];
        if (addTitle) filters.push('companyName');
        let url = `${BASE_URL}?types=quote&symbols=${symbols.join(',')}&filter=${filters.join(',')}&token=${API_TOKEN}`;
        fetch(url).then(response => response.json()).then(json => {
          symbols.forEach(symbol => {
            let data = json[symbol];
            if (typeof(data) === 'undefined' || !data.quote.latestPrice) return;
            let formattedPrice = formatQuote(Number(data.quote.latestPrice));
            let formattedChange = formatChange(data.quote.change);
            let formattedChangePercent = formatChangePercent(data.quote.changePercent);
            let formattedMarketCap = formatMarketCap(data.quote.marketCap);
            let bgColorStyle = calculateBgColorStyle(data.quote.changePercent)
            document.querySelectorAll(`[data-symbol="${symbol}"] .stock-price`).forEach(e => {
              e.innerHTML = formattedPrice;
              e.setAttribute('style', bgColorStyle);
            });
            document.querySelectorAll(`[data-symbol="${symbol}"] .stock-change`).forEach(e => {
              e.innerHTML = formattedChange;
              e.setAttribute('style', bgColorStyle);
            });
            document.querySelectorAll(`[data-symbol="${symbol}"] .stock-change-pct`).forEach(e => {
              e.innerHTML = formattedChangePercent;
              e.setAttribute('style', bgColorStyle);
            });
            document.querySelectorAll(`[data-symbol="${symbol}"] .stock-mkt-cap`).forEach(e => {
              e.innerHTML = formattedMarketCap;
              e.setAttribute('style', bgColorStyle);
            });
            if (addTitle) {
              document.querySelectorAll(`[data-symbol="${symbol}"] .stock-symbol a`).forEach(e => {
                e.setAttribute('title', data.quote.companyName);
              });
            }
            if (symbol === FAVICON_SYMBOL) {
              updateFavicon(data.quote);
            }
          });
        });
      }
      function portfoliosFromQueryParams() {
        if (!window.location.search) return;
        let params = new URLSearchParams(window.location.search);
        let portfolios = [];
        for (let p of params) {
          portfolios.push({'name': p[0], 'symbols': p[1].split(',')});
        }
        return portfolios;
      }
      function symbolUrl(symbol) {
        return `https://iextrading.com/apps/stocks/${symbol}`;
      }
      function formatChange(value) {
        if (value === null || value === undefined) return '';
        return value.toLocaleString('en', {'minimumFractionDigits': 2});
      }
      function formatChangePercent(value) {
        if (value === null || value === undefined) return '';
        return (value * 100).toFixed(1) + '%';
      }
      function formatQuote(value) {
        let options = {
          'minimumFractionDigits': 2,
          'style': 'currency',
          'currency': 'USD'
        };
        return value.toLocaleString('en', options);
      }
      function formatMarketCap(marketCap) {
        if (marketCap === null || marketCap === 0 || marketCap === undefined) return '';

        let value, suffix;
        if (marketCap >= 1e12) {
          value = marketCap / 1e12;
          suffix = 'T';
        } else if (marketCap >= 1e9) {
          value = marketCap / 1e9;
          suffix = 'B';
        } else {
          value = marketCap / 1e6;
          suffix = 'M';
        }
        let digits = value < 10 ? 1 : 0;
        return '$' + value.toFixed(digits) + suffix;
      }
      function calculateBgColorStyle(changePercent) {
        if (changePercent === undefined) return '';
        let rgbColor = changePercent > 0 ? '0,255,0' : '255,0,0';
        let rgbOpacity = Math.min(Math.abs(changePercent) * 20, 1);
        return `background-color: rgba(${rgbColor}, ${rgbOpacity})`;
      }
      function updateFavicon(quote) {
        let favicon = document.querySelector('link[rel="icon"]');
        let path = quote.change < 0 ? 'favicon_down.ico' : 'favicon.ico';
        let href = `${FAVICON_BASE_URL}/${path}`;
        if (favicon.getAttribute('href') !== href) {
          favicon.setAttribute('href', href);
        }
      }

    // Countdown timer script

    // Set the date we're counting down to
    var countDownDate = new Date("09/08/2020").getTime(); // 09/09/2020 = first day of kindergarten, 0.25 FTE after 09/04/2020

    function calcFire() {
      // Get todays date and time
      var now = new Date().getTime();
      // Find the distance between now and the countdown date
      var distance = countDownDate - now;
      // Time calculations for days, hours, minutes and seconds
      var days = Math.floor(distance / (1000 * 60 * 60 * 24));
      var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      var seconds = Math.floor((distance % (1000 * 60)) / 1000);

      // Display the result in the element with id="fire"
      document.getElementById("fire").innerHTML = "⏰ " + days + " days until FIRE";

      // If the count down is finished, write some text
      if (distance < 0) {
        clearInterval(x);
        document.getElementById("fire").innerHTML = "⏰ Part-time FIRE!";
      }
    }

    // Update the count down every 12 seconds
    var x = setInterval(calcFire, REFRESH_SECONDS * 200);
    // End countdown script

    // Tab script
    function openTab(evt, tabName) {
      // Declare all variables
      var i, tabcontent, tablinks;

      // Get all elements with class="tabcontent" and hide them
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }

      // Get all elements with class="tablinks" and remove the class "active"
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }

      // Show the current tab, and add an "active" class to the button that opened the tab
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";
    }

    // Get the element with id="defaultOpen" and click on it
    document.getElementById("defaultOpen").click();

    </script>

  </body>
</html>